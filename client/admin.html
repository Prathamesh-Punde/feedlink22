<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Manage Donees | FeedLink</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
  <style>
    .donee-card {
      transition: all 0.3s ease;
      border-left: 4px solid #28a745;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    .donee-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      border-left-color: #007bff;
    }
    .spinner-border {
      width: 2rem;
      height: 2rem;
    }
    #doneesContainer {
      max-height: 70vh;
      overflow-y: auto;
      padding-right: 5px;
    }
    #doneesContainer::-webkit-scrollbar {
      width: 6px;
    }
    #doneesContainer::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    #doneesContainer::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 10px;
    }
    #doneesContainer::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
    .card {
      border-radius: 12px;
      transition: all 0.3s ease;
    }
    .card:hover {
      transform: translateY(-2px);
    }
    .nav-pills .nav-link {
      border-radius: 25px;
      font-weight: 500;
      padding: 12px 24px;
      margin: 0 5px;
      transition: all 0.3s ease;
    }
    .nav-pills .nav-link.active {
      background: linear-gradient(135deg, #f0f4f8, #d9e4ec, #a6c1de);
      border: none;
      color: #333;
    }
    .form-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #007bff;
    }
    .form-control:focus {
      border-color: #a6c1de;
      box-shadow: 0 0 0 0.2rem rgba(166, 193, 222, 0.25);
    }
    .btn-primary {
      background: linear-gradient(135deg, #f0f4f8, #d9e4ec, #a6c1de);
      border: none;
      border-radius: 25px;
      font-weight: 500;
      color: #333;
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(166, 193, 222, 0.4);
      color: #333;
    }
    .jumbotron {
      border-radius: 15px !important;
    }
    .font-weight-semibold {
      font-weight: 600;
    }
    .alert-light {
      background-color: #f8f9ff;
    }
    .info-item {
      display: flex;
      align-items: flex-start;
    }
    .info-label {
      font-weight: 600;
      color: #495057;
      min-width: 110px;
      margin-right: 8px;
    }
    .info-value {
      color: #212529;
      word-break: break-word;
    }
    .font-monospace {
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
    }
    .dropdown-toggle::after {
      display: none;
    }
    @media (max-width: 768px) {
      .info-item {
        flex-direction: column;
      }
      .info-label {
        min-width: auto;
        margin-bottom: 4px;
      }
    }
  </style>
</head>
<body>
  <!-- Admin Login Modal -->
  <div class="modal fade" id="adminLoginModal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title">üîí Admin Access Required</h5>
        </div>
        <div class="modal-body">
          <form id="adminLoginForm">
            <div class="form-group">
              <label for="adminId">Admin ID:</label>
              <input type="text" class="form-control" id="adminId" required>
            </div>
            <div class="form-group">
              <label for="adminPassword">Password:</label>
              <input type="password" class="form-control" id="adminPassword" required>
            </div>
            <div id="loginError" class="alert alert-danger d-none"></div>
            <div class="text-center">
              <button type="submit" class="btn btn-danger">Login</button>
              <a href="index.html" class="btn btn-secondary ml-2">Back to Home</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Admin Content (Initially Hidden) -->
  <div id="adminContent" style="display: none;">
  <!-- Header -->
  <header class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="index.html"><img src="img/logo.png" alt="Logo" class="logo"></a>
    <ul class="navbar-nav ml-auto">
      <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
      <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
      <li class="nav-item"><a class="nav-link" href="Donate.html">Donate</a></li>
      <li class="nav-item"><a class="nav-link" href="locateadonee.html">Locate</a></li>
      <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
      <li class="nav-item"><span class="nav-link text-danger">Admin Panel</span></li>
      <li class="nav-item"><button class="btn btn-outline-danger btn-sm" onclick="adminLogout()">Logout</button></li>
    </ul>
  </header>

  <div class="container-fluid mt-4">
    <!-- Welcome Header -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="jumbotron jumbotron-fluid bg-gradient text-dark" style="background: linear-gradient(135deg, #f0f4f8, #d9e4ec, #a6c1de); border-radius: 10px;">
          <div class="container text-center">
            <h1 class="display-4">Admin Dashboard</h1>
            <button class="btn btn-dark btn-lg" onclick="loadAdminStats()">
              üîÑ Refresh Data
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
      <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body text-center">
            <div class="text-primary mb-3">
              <i class="fas fa-users fa-3x" style="font-size: 3rem;">üë•</i>
            </div>
            <h3 class="card-title text-primary" id="totalUsers">-</h3>
            <p class="card-text text-muted">Total Registered Users</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body text-center">
            <div class="text-success mb-3">
              <i class="fas fa-building fa-3x" style="font-size: 3rem;">üè¢</i>
            </div>
            <h3 class="card-title text-success" id="totalDonees">-</h3>
            <p class="card-text text-muted">Total Donees</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body text-center">
            <div class="text-warning mb-3">
              <i class="fas fa-user-plus fa-3x" style="font-size: 3rem;">üìà</i>
            </div>
            <h3 class="card-title text-warning" id="recentUsers">-</h3>
            <p class="card-text text-muted">New Users (7 days)</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Navigation -->
    <div class="row">
      <div class="col-12">
        <ul class="nav nav-pills nav-fill mb-4" id="adminTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <a class="nav-link active" id="manage-tab" data-toggle="pill" href="#manage" role="tab">
              üë• Manage Donees
            </a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" id="add-tab" data-toggle="pill" href="#add" role="tab">
              ‚ûï Add New Donee
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Tab Content -->
    <div class="tab-content" id="adminTabContent">
      <!-- Manage Donees Tab -->
      <div class="tab-pane fade show active" id="manage" role="tabpanel">
        <div class="row">
          <div class="col-12">
            <div class="card border-0 shadow">
              <div class="card-header bg-white border-bottom-0">
                <div class="d-flex justify-content-between align-items-center">
                  <h5 class="mb-0 text-dark">üë• Current Donees</h5>
                  <small class="text-muted">Recently added donees appear first</small>
                </div>
              </div>
              <div class="card-body">
                <div id="doneesContainer">
                  <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                      <span class="sr-only">Loading...</span>
                    </div>
                    <p class="mt-3 text-muted">Loading donees...</p>
                  </div>
                </div>
                <div class="text-center mt-4">
                  <button id="loadMoreBtn" class="btn btn-outline-primary" style="display: none;" onclick="loadMoreDonees()">
                    üìÑ Load More Donees
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Add New Donee Tab -->
      <div class="tab-pane fade" id="add" role="tabpanel">
        <div class="row justify-content-center">
          <div class="col-lg-8">
            <div class="card border-0 shadow">
              <div class="card-header bg-white text-center border-bottom-0">
                <h5 class="mb-0 text-dark">üè¢ Add New Donee Organization</h5>
                <p class="text-muted mb-0">Fill in the details to add a new donee to the system</p>
              </div>
              <div class="card-body p-4">
                <form id="doneeForm">
                  <!-- Basic Information Section -->
                  <div class="form-section mb-4">
                    <h6 class="text-primary mb-3">üìù Basic Information</h6>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="name" class="font-weight-semibold">Organization/Person Name *</label>
                          <input type="text" class="form-control form-control-lg" name="name" id="name" required 
                                 placeholder="e.g., Local Food Bank, Community Center">
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="contact" class="font-weight-semibold">Contact Number *</label>
                          <input type="tel" class="form-control form-control-lg" name="contact" id="contact" required 
                                 placeholder="e.g., +91-9876543210">
                        </div>
                      </div>
                    </div>
                    
                    <div class="form-group">
                      <label for="email" class="font-weight-semibold">Email Address *</label>
                      <input type="email" class="form-control form-control-lg" name="email" id="email" required
                             placeholder="e.g., organization@example.com">
                      <small class="form-text text-muted">üìß Required for donation notifications</small>
                    </div>
                  </div>

                  <!-- Additional Details Section -->
                  <div class="form-section mb-4">
                    <h6 class="text-primary mb-3">üìã Additional Details</h6>
                    <div class="row">
                      <div class="col-md-8">
                        <div class="form-group">
                          <label for="address" class="font-weight-semibold">Address</label>
                          <textarea class="form-control" name="address" id="address" rows="3" 
                                    placeholder="Full address including city, state"></textarea>
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="form-group">
                          <label for="beneficiaries" class="font-weight-semibold">Beneficiaries</label>
                          <input type="number" class="form-control form-control-lg" name="beneficiaries" id="beneficiaries" 
                                 min="1" placeholder="e.g., 50">
                          <small class="form-text text-muted">People helped</small>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Location Section -->
                  <div class="form-section mb-4">
                    <h6 class="text-primary mb-3">üìç Location Coordinates</h6>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="lat" class="font-weight-semibold">Latitude *</label>
                          <input type="number" step="any" class="form-control form-control-lg" name="lat" id="lat" required 
                                 placeholder="e.g., 40.7128">
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="lng" class="font-weight-semibold">Longitude *</label>
                          <input type="number" step="any" class="form-control form-control-lg" name="lng" id="lng" required 
                                 placeholder="e.g., -74.0060">
                        </div>
                      </div>
                    </div>
                    
                    <div class="alert alert-light border border-info">
                      <div class="d-flex align-items-center">
                        <span class="mr-2">üí°</span>
                        <div>
                          <strong>Need coordinates?</strong><br>
                          <small class="text-muted">Right-click on Google Maps and copy the coordinates, or use the button below to detect your current location.</small>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Action Buttons -->
                  <div class="text-center pt-3 border-top">
                    <button type="submit" class="btn btn-primary btn-lg px-5 mr-3">
                      ‚ûï Add Donee
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-lg px-4" onclick="getCurrentLocation()">
                      üìç Use My Location
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Load admin statistics on page load
    async function loadAdminStats() {
      try {
        const res = await fetch('/api/admin/stats');
        const stats = await res.json();
        
        if (res.ok) {
          document.getElementById('totalUsers').textContent = stats.totalUsers || 0;
          document.getElementById('totalDonees').textContent = stats.totalDonees || 0;
          document.getElementById('recentUsers').textContent = stats.recentUsers || 0;
        } else {
          console.error('Failed to load stats:', stats.error);
          // Show fallback values
          document.getElementById('totalUsers').textContent = 'Error';
          document.getElementById('totalDonees').textContent = 'Error';
          document.getElementById('recentUsers').textContent = 'Error';
        }
      } catch (error) {
        console.error('Error fetching admin stats:', error);
        document.getElementById('totalUsers').textContent = 'Error';
        document.getElementById('totalDonees').textContent = 'Error';
        document.getElementById('recentUsers').textContent = 'Error';
      }
    }

    // Load stats when page loads - REMOVED, now called after authentication
    // document.addEventListener('DOMContentLoaded', loadAdminStats);

    document.getElementById('doneeForm').addEventListener('submit', async e => {
      e.preventDefault();
      
      // Show loading state
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      const isEditing = e.target.querySelector('input[name="doneeId"]');
      
      submitBtn.innerHTML = isEditing ? '‚è≥ Updating...' : '‚è≥ Adding...';
      submitBtn.disabled = true;
      
      try {
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());
        
        // Validate coordinates
        if (!data.lat || !data.lng) {
          throw new Error('Latitude and Longitude are required');
        }
        
        let res, result;
        
        if (isEditing) {
          // Update existing donee
          const doneeId = data.doneeId;
          delete data.doneeId; // Remove from data before sending
          
          res = await fetch(`/api/admin/donees/${doneeId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
        } else {
          // Add new donee
          res = await fetch('/api/donees', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
        }

        result = await res.json();
        
        if (res.ok) {
          const action = isEditing ? 'updated' : 'added';
          showAlert(`‚úÖ Donee ${action} successfully!`, 'success');
          
          // Reset form and edit mode
          e.target.reset();
          if (isEditing) {
            cancelEdit();
            // Switch back to manage tab after successful edit
            setTimeout(() => {
              document.getElementById('manage-tab').click();
            }, 1000);
          }
          
          // Refresh admin stats and donees list
          loadAdminStats();
          loadDonees(true);
        } else {
          throw new Error(result.error || `Failed to ${isEditing ? 'update' : 'add'} donee`);
        }
        
      } catch (error) {
        showAlert('‚ùå Error: ' + error.message, 'danger');
      } finally {
        // Reset button
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    });

    function getCurrentLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          position => {
            document.getElementById('lat').value = position.coords.latitude.toFixed(6);
            document.getElementById('lng').value = position.coords.longitude.toFixed(6);
            showAlert('üìç Location detected successfully!', 'info');
          },
          error => {
            showAlert('‚ùå Could not get your location: ' + error.message, 'warning');
          }
        );
      } else {
        showAlert('‚ùå Geolocation is not supported by this browser.', 'warning');
      }
    }

    function showAlert(message, type) {
      // Remove existing alerts
      const existingAlert = document.querySelector('.alert-dismissible');
      if (existingAlert) existingAlert.remove();
      
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert alert-${type} alert-dismissible fade show mt-3`;
      alertDiv.innerHTML = `
        ${message}
        <button type="button" class="close" data-dismiss="alert">
          <span>&times;</span>
        </button>
      `;
      
      document.querySelector('.card-body').appendChild(alertDiv);
      
      // Auto-dismiss success messages
      if (type === 'success') {
        setTimeout(() => alertDiv.remove(), 3000);
      }
    }

    // Donee management variables
    let allDonees = [];
    let currentSkip = 0;
    let hasMoreDonees = true;

    // Load donees from API
    async function loadDonees(reset = false) {
      try {
        if (reset) {
          currentSkip = 0;
          allDonees = [];
          hasMoreDonees = true;
        }

        const res = await fetch(`/api/admin/donees?limit=3&skip=${currentSkip}`);
        const data = await res.json();
        
        if (res.ok) {
          allDonees = reset ? data.donees : [...allDonees, ...data.donees];
          hasMoreDonees = data.hasMore;
          currentSkip += data.donees.length;
          
          displayDonees();
          updateLoadMoreButton();
        } else {
          throw new Error(data.error || 'Failed to load donees');
        }
      } catch (error) {
        console.error('Error loading donees:', error);
        document.getElementById('doneesContainer').innerHTML = `
          <div class="alert alert-danger">
            ‚ùå Error loading donees: ${error.message}
          </div>
        `;
      }
    }

    // Display donees in the UI
    function displayDonees() {
      const container = document.getElementById('doneesContainer');
      
      if (allDonees.length === 0) {
        container.innerHTML = `
          <div class="text-center py-5">
            <div class="text-muted mb-4">
              <i style="font-size: 4rem;">üì≠</i>
            </div>
            <h5 class="text-muted">No donees found</h5>
            <p class="text-muted mb-4">Add your first donee using the "Add New Donee" tab</p>
            <button class="btn btn-primary" onclick="document.getElementById('add-tab').click()">
              ‚ûï Add First Donee
            </button>
          </div>
        `;
        return;
      }

      container.innerHTML = allDonees.map((donee, index) => `
        <div class="donee-card shadow-sm border-0" data-donee-id="${donee._id}">
          <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div class="d-flex align-items-center">
                <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center mr-3" style="width: 50px; height: 50px; font-size: 1.2rem;">
                  üè¢
                </div>
                <div>
                  <h5 class="mb-1 text-dark font-weight-bold">${donee.name}</h5>
                  <small class="text-muted">#${index + 1} ‚Ä¢ Added recently</small>
                </div>
              </div>
              <div class="dropdown">
                <button class="btn btn-light btn-sm" type="button" data-toggle="dropdown">
                  ‚ãÆ
                </button>
                <div class="dropdown-menu dropdown-menu-right">
                  <button class="dropdown-item" onclick="editDonee('${donee._id}')">
                    <i class="text-warning">‚úèÔ∏è</i> Edit Details
                  </button>
                  <div class="dropdown-divider"></div>
                  <button class="dropdown-item text-danger" onclick="deleteDonee('${donee._id}', '${donee.name}')">
                    <i>üóëÔ∏è</i> Delete
                  </button>
                </div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="info-item mb-2">
                  <span class="info-label">üìû Contact:</span>
                  <span class="info-value">${donee.contact}</span>
                </div>
                <div class="info-item mb-2">
                  <span class="info-label">üìß Email:</span>
                  <span class="info-value">${donee.email || '<span class="text-muted">Not provided</span>'}</span>
                </div>
                <div class="info-item mb-2">
                  <span class="info-label">ÔøΩ Beneficiaries:</span>
                  <span class="info-value">${donee.beneficiaries || '<span class="text-muted">Not specified</span>'}</span>
                </div>
              </div>
              <div class="col-md-6">
                <div class="info-item mb-2">
                  <span class="info-label">üìç Address:</span>
                  <span class="info-value">${donee.address || '<span class="text-muted">Not provided</span>'}</span>
                </div>
                <div class="info-item mb-2">
                  <span class="info-label">üó∫Ô∏è Coordinates:</span>
                  <span class="info-value font-monospace">${donee.location.coordinates[1].toFixed(4)}, ${donee.location.coordinates[0].toFixed(4)}</span>
                </div>
              </div>
            </div>
            
            <div class="mt-3 pt-3 border-top d-flex justify-content-end">
              <button class="btn btn-outline-primary btn-sm mr-2" onclick="editDonee('${donee._id}')">
                ‚úèÔ∏è Edit
              </button>
              <button class="btn btn-outline-danger btn-sm" onclick="deleteDonee('${donee._id}', '${donee.name}')">
                üóëÔ∏è Remove
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Update load more button visibility
    function updateLoadMoreButton() {
      const loadMoreBtn = document.getElementById('loadMoreBtn');
      loadMoreBtn.style.display = hasMoreDonees ? 'inline-block' : 'none';
    }

    // Load more donees
    function loadMoreDonees() {
      loadDonees(false);
    }

    // Edit donee
    function editDonee(doneeId) {
      const donee = allDonees.find(d => d._id === doneeId);
      if (!donee) return;

      // Populate form with donee data
      document.getElementById('name').value = donee.name;
      document.getElementById('contact').value = donee.contact;
      document.getElementById('email').value = donee.email || '';
      document.getElementById('address').value = donee.address || '';
      document.getElementById('beneficiaries').value = donee.beneficiaries || '';
      document.getElementById('lat').value = donee.location.coordinates[1];
      document.getElementById('lng').value = donee.location.coordinates[0];

      // Change form to edit mode
      const form = document.getElementById('doneeForm');
      const submitBtn = form.querySelector('button[type="submit"]');
      
      submitBtn.innerHTML = 'üíæ Update Donee';
      submitBtn.className = 'btn btn-warning btn-lg';
      
      // Add hidden input for donee ID
      let hiddenInput = form.querySelector('input[name="doneeId"]');
      if (!hiddenInput) {
        hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = 'doneeId';
        form.appendChild(hiddenInput);
      }
      hiddenInput.value = doneeId;

      // Add cancel button
      let cancelBtn = form.querySelector('.cancel-edit-btn');
      if (!cancelBtn) {
        cancelBtn = document.createElement('button');
        cancelBtn.type = 'button';
        cancelBtn.className = 'btn btn-outline-secondary btn-lg px-4 cancel-edit-btn';
        cancelBtn.innerHTML = '‚ùå Cancel';
        cancelBtn.onclick = cancelEdit;
        submitBtn.parentNode.appendChild(cancelBtn);
      }

      // Switch to Add tab and scroll to form
      document.getElementById('add-tab').click();
      setTimeout(() => {
        form.scrollIntoView({ behavior: 'smooth' });
      }, 300);
    }

    // Cancel edit mode
    function cancelEdit() {
      const form = document.getElementById('doneeForm');
      form.reset();
      
      // Reset submit button
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.innerHTML = '‚ûï Add Donee';
      submitBtn.className = 'btn btn-primary btn-lg';
      
      // Remove hidden input and cancel button
      const hiddenInput = form.querySelector('input[name="doneeId"]');
      if (hiddenInput) hiddenInput.remove();
      
      const cancelBtn = form.querySelector('.cancel-edit-btn');
      if (cancelBtn) cancelBtn.remove();
    }

    // Delete donee
    async function deleteDonee(doneeId, doneeName) {
      if (!confirm(`‚ö†Ô∏è Are you sure you want to delete "${doneeName}"?\n\nThis action cannot be undone.`)) {
        return;
      }

      try {
        const res = await fetch(`/api/admin/donees/${doneeId}`, {
          method: 'DELETE'
        });

        const result = await res.json();
        
        if (res.ok) {
          showAlert('‚úÖ Donee deleted successfully!', 'success');
          // Reload donees and stats
          loadDonees(true);
          loadAdminStats();
        } else {
          throw new Error(result.error || 'Failed to delete donee');
        }
        
      } catch (error) {
        showAlert('‚ùå Error deleting donee: ' + error.message, 'danger');
      }
    }
  </script>

  </div> <!-- End of adminContent -->

  <!-- Bootstrap JS for modal functionality -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Admin authentication
    const ADMIN_CREDENTIALS = {
      id: 'admin',
      password: 'admin'
    };

    // Check if admin is already authenticated
    function checkAdminAuth() {
      const isAuthenticated = sessionStorage.getItem('adminAuthenticated');
      if (isAuthenticated === 'true') {
        showAdminContent();
      } else {
        showLoginModal();
      }
    }

    // Show login modal
    function showLoginModal() {
      $('#adminLoginModal').modal('show');
    }

    // Show admin content
    function showAdminContent() {
      document.getElementById('adminContent').style.display = 'block';
      $('#adminLoginModal').modal('hide');
      // Load stats and donees when admin content is shown
      loadAdminStats();
      loadDonees(true);
    }

    // Admin login form handler
    document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const enteredId = document.getElementById('adminId').value;
      const enteredPassword = document.getElementById('adminPassword').value;
      const errorDiv = document.getElementById('loginError');

      if (enteredId === ADMIN_CREDENTIALS.id && enteredPassword === ADMIN_CREDENTIALS.password) {
        sessionStorage.setItem('adminAuthenticated', 'true');
        showAdminContent();
        errorDiv.classList.add('d-none');
      } else {
        errorDiv.textContent = '‚ùå Invalid credentials. Please try again.';
        errorDiv.classList.remove('d-none');
        // Clear the form
        document.getElementById('adminId').value = '';
        document.getElementById('adminPassword').value = '';
      }
    });

    // Admin logout
    function adminLogout() {
      if (confirm('Are you sure you want to logout?')) {
        sessionStorage.removeItem('adminAuthenticated');
        window.location.reload();
      }
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      checkAdminAuth();
    });
  </script>
</body>
</html>
